<head>
  <base href="/manpo/">
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
  <script>
    let _handler = null;

    async function requestMotionPermission() {
      if (typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function") {
        const res = await DeviceMotionEvent.requestPermission();
        if (res !== "granted") throw new Error("Motion permission denied");
      }
    }

    function startMotion(onData) {
      stopMotion();
        _handler = (e) => {
        const a = e.accelerationIncludingGravity;
        if (!a) return;
        onData(a.x ?? 0, a.y ?? 0, a.z ?? 0, Date.now());
      };
      window.addEventListener("devicemotion", _handler, { passive: true });
    }

    function stopMotion() {
      if (_handler) {
        window.removeEventListener("devicemotion", _handler);
        _handler = null;
      }
    }

    window.ManpoKei = {
      requestMotionPermission,
      startMotion,
      stopMotion
    };
  </script>
</body>